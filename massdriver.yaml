schema: draft-07
name: azure-virtual-network
description: "Azure Virtual Network includes best practice Azure reference architecture for Virtual Networks (VNETs) and subnets."
source_url: github.com/massdriver-cloud/azure-virtual-network
access: "public"
type: bundle

params:
  examples: []
  required:
    - network
  properties:
    network:
        title: Network
        type: object
        required:
          - azure_region
          - auto
        properties:
          region:
            description: Select the Azure region you'd like to provision your resources in. This cannot be changed after the resource is created.
            $ref: https://raw.githubusercontent.com/massdriver-cloud/artifact-definitions/main/definitions/types/azure-region.json
            $md.immutable: true
          auto:
            title: Automatic CIDR Selection
            type: boolean
            description: Enabling this will automatically select an available CIDR range for your database. Unchecking will require you to specify the CIDR.
            default: true
            $md.immutable: true
        dependencies:
          auto:
            oneOf:
            - properties:
                auto:
                  const: true
            - properties:
                auto:
                  const: false
                cidr:
                  title: Subnet CIDR
                  type: string
                  description: Specify a /28 CIDR range within your vnet to create subnet for the database. The subnet CIDR cannot be changed after creation.
                  $md.immutable: true
                  pattern: ^(?:10\.(?:[0-9]|[0-9]{2}|1[0-9][0-9]|2[0-4][0-9]|25[0-5])|172\.(?:1[6-9]|2[0-9]|3[0-1])|192\.168)(?:\.(?:[0-9]|[0-9]{2}|1[0-9][0-9]|2[0-4][0-9]|25[0-5])){2}\/28$
                  message:
                    pattern: "Must be a /28 range from within the VNet CIDR"
              required:
              - cidr

connections:
  required:
    - azure_service_principal
  properties:
    azure_service_principal:
      $ref: massdriver/azure-service-principal

artifacts:
  required:
    - vnet
  properties:
    vnet:
      $ref: massdriver/azure-virtual-network

ui:
  ui:order:
    - network
    - "*"
  network:
    ui:order:
      - region
      - auto
      - "*"
